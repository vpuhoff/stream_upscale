
# RTSP Stream Upscaling with Waifu2x

Этот проект позволяет захватывать RTSP-поток, увеличивать разрешение видео кадров с помощью `waifu2x-ncnn-vulkan` и выводить результат в другой RTSP-поток. Он полезен для улучшения качества видео в режиме реального времени с помощью алгоритмов апскейлинга.

## Требования

1. **Python 3.8+**
2. **`waifu2x-ncnn-vulkan`** — необходимо скачать и установить отдельно, поскольку он запускается как внешняя программа. Вы можете загрузить его отсюда: [waifu2x-ncnn-vulkan GitHub](https://github.com/nihui/waifu2x-ncnn-vulkan).
3. **ffmpeg** — необходим для кодирования и трансляции RTSP-потока. Убедитесь, что он установлен и доступен в PATH.

## Установка

1. **Склонируйте репозиторий**:

   ```bash
   git clone https://github.com/your-username/rtsp-upscale-waifu2x.git
   cd rtsp-upscale-waifu2x
   ```

2. **Создайте виртуальное окружение и установите зависимости**:

   ```bash
   pip install pipenv
   pipenv install
   ```

3. **Убедитесь, что `waifu2x-ncnn-vulkan` доступен в PATH или укажите путь к нему**:

   Загрузите и распакуйте `waifu2x-ncnn-vulkan`. Затем скопируйте путь к `waifu2x-ncnn-vulkan` и укажите его в переменной `waifu2x_path` в основном скрипте.

   ```python
   waifu2x_path = "/path/to/waifu2x-ncnn-vulkan"
   ```

4. **Убедитесь, что `ffmpeg` установлен и доступен**:

   Для Ubuntu:

   ```bash
   sudo apt update
   sudo apt install ffmpeg
   ```

   Для Windows скачайте [ffmpeg](https://ffmpeg.org/download.html) и добавьте его в PATH.

## Настройка RTSP-потоков

1. **Входной RTSP-поток**: Укажите URL RTSP-источника в переменной `input_rtsp_url` в коде. Пример:

   ```python
   input_rtsp_url = "rtsp://username:password@input_stream_url"
   ```

2. **Выходной RTSP-поток**: Укажите URL для трансляции обработанного видео в переменной `output_rtsp_url`. Например, если вы хотите транслировать локально:

   ```python
   output_rtsp_url = "rtsp://localhost:8554/output_stream"
   ```

## Запуск

1. Запустите скрипт:

   ```bash
   pipenv run python main.py
   ```

2. **Примечание**: Скрипт обрабатывает каждый N-ый кадр с помощью waifu2x для экономии ресурсов, а пропущенные кадры заменяются последним обработанным кадром. Вы можете изменить параметр `process_every_n_frames` в скрипте, чтобы настроить частоту обработки (например, `process_every_n_frames = 5` для обработки каждого 5-го кадра).

## Переменные и параметры

- `input_rtsp_url`: URL RTSP-потока, который вы хотите обработать.
- `output_rtsp_url`: URL RTSP-потока для трансляции обработанного видео.
- `process_every_n_frames`: частота обработки кадров. Установка этого параметра на более высокое значение уменьшает нагрузку на систему, но снижает частоту обновления обработанных кадров.

## Проблемы и отладка

- **`ffmpeg` не установлен**: Убедитесь, что `ffmpeg` установлен и доступен в PATH.
- **`waifu2x-ncnn-vulkan` не найден**: Проверьте путь к `waifu2x-ncnn-vulkan` и убедитесь, что он указан правильно.
- **Снижение производительности**: Попробуйте увеличить значение `process_every_n_frames`, чтобы обрабатывать кадры реже, либо используйте GPU с большим объёмом памяти.

## Лицензия

Этот проект лицензирован под MIT License.
